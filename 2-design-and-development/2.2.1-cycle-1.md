# 2.2.1 Cycle 1: Setup database

## Design

In this cycle, I will setup the database for the account system of my game. This will comprise of two tables. The first one of these is called "users", and will store each username alongside a hashed password. The second one is called "sessions" and will store UUIDs that are generated each time a user signs in alongside their usernames. A session will be saved in a cookie on signing in rather than the username as a security measure.

### Objectives

* [x] Listen Express.js application on local port.
* [x] Create an asynchronous function that opens the database, creating it if nonexistent, using the SQLite module.
* [x] In the function, create two tables for users and sessions if they do not already exist.
* [x] In the users table, have two fields for username and password.
* [x] In the sessions table, have two fields for session and username.
* [x] Return database object.

### Usability Features

### Key Variables

| Variable Name | Use                                                                                                     |
| ------------- | ------------------------------------------------------------------------------------------------------- |
| app           | Express.js app, this will be used for handling POST requests and working with browser cookies later on. |
| server        | HTTP server hosting Express.js app.                                                                     |
| port          | Port HTTP server will listen for connections on.                                                        |
| db            | Object allowing reading and writing of data to a SQLite database from Node.js.                          |

### Pseudocode

{% code title="server.js" %}
```
import http, sqlite3, sqlite
import 'app.js'

server = http.create_server(app)

port = 8080

server.listen(port, func () {
    print("Server listening on port " + port)
})

func async openDatabase() {
    db = await sqlite.open("data.db", driver: sqlite3.Database)
    
    db.run(`CREATE TABLE IF NOT EXISTS users (
            username TEXT UNIQUE,
            password TEXT
        )
    `)
    
    db.run(`CREATE TABLE IF NOT EXISTS sessions (
            session TEXT UNIQUE,
            username TEXT
        )
    `)
    
    return db
}

openDatabase()
```
{% endcode %}

{% code title="app.js" %}
```
import express

app = express()
app.static("/public")

module.exports = app
```
{% endcode %}

## Development

### Outcome



### Challenges



## Testing

Evidence for testing

### Tests

<table><thead><tr><th width="95">Test</th><th width="158">Instructions</th><th width="171">What I expect</th><th width="174">What actually happens</th><th>Pass/Fail</th></tr></thead><tbody><tr><td>1</td><td>Listen Express.js application on port 8080.</td><td>Express.js application accessible through a web browser at http://localhost:8080.</td><td>As expected</td><td>Pass</td></tr><tr><td>2</td><td>Create new SQLite database file using Node.js.</td><td>New file "data.db" created in project folder after starting server.</td><td>As expected</td><td>Pass</td></tr><tr><td>3</td><td>Execute SQL commands to create users and sessions tables if they don't exist.</td><td>users and sessions tables with their respective fields created in data.db after starting server.</td><td>As expected</td><td>Pass</td></tr></tbody></table>

### Evidence

<figure><img src="../.gitbook/assets/image (5).png" alt=""><figcaption><p>Test 1: Error cannot GET / on accessing http://localhost:8080 (this is supposed to happen as I haven't made any pages yet)</p></figcaption></figure>

<figure><img src="../.gitbook/assets/image (6).png" alt=""><figcaption><p>Test 1: Message saying server is listening on port outputted to server console.</p></figcaption></figure>

<figure><img src="../.gitbook/assets/image (7).png" alt=""><figcaption><p>Test 2: data.db file shows in project folder.</p></figcaption></figure>

<figure><img src="../.gitbook/assets/image (8).png" alt=""><figcaption><p>Test 3: sessions table created in database file with fields "session" and "username"</p></figcaption></figure>

<figure><img src="../.gitbook/assets/image (9).png" alt=""><figcaption><p>Test 3: users table created in database file with fields "username" and "password"</p></figcaption></figure>
