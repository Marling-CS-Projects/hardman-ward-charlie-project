# 2.2.4 Cycle 4: Check if player is signed in

## Design

In this cycle, I will be writing the code to check if the player is signed in when they attempt to access the page my game will be on. This will be accomplished by getting the value of the session cookie saved on signing in and submitting it in a new POST request to the server, which will retrieve the corresponding username value from the sessions table of my database. If no username is found, a message exclaiming the user is not signed in will be outputted to the browser console. If a username is found, that will be outputted to the browser console instead.&#x20;

My game will require players be signed in to play, so this check will be used in the next cycle to determine which scene to load when opening the game. If the player is not signed in, they will be shown a message informing them they must be along with a button that takes them to the form. Otherwise, if they are signed in, they will be shown the title screen which allows them to play the game.

### Objectives

* [x] Obtain session from the browser cookie.
* [x] Send a POST request with the session.
* [x] Get username corresponding to the session from the sessions table.
* [x] Output a message to the browser console showing the username.
* [x] If no entry was found, output a message saying the user is not signed in.

### Usability Features

### Key Variables

| Variable Name | Use |
| ------------- | --- |
|               |     |

### Pseudocode

{% code title="index.js" %}
```
let session = document.cookie.split("=")[1]

send_post_request('/get-username', session,
    success: res => {
        username = res
        console.log("You are signed in as " + username)
    }
    error: => {
        console.log("You are not signed in.")
    }
)
```
{% endcode %}

{% code title="app.js" %}
```
app.post('/get-username', func (req, res) => {
    db = openDatabase()
    
    session = req.body.session
    
    entry = await db.get("SELECT * FROM sessions WHERE session = ?", session)
    
    if (!entry) {
        res.error(404)
        return
    }
    
    res.end(entry.username)
})
```
{% endcode %}

## Development

### Outcome



### Challenges



## Testing

Evidence for testing

### Tests

<table><thead><tr><th width="95">Test</th><th width="158">Instructions</th><th width="171">What I expect</th><th width="174">What actually happens</th><th>Pass/Fail</th></tr></thead><tbody><tr><td>1</td><td>Split cookie string at "=" and get item 1 (second item), which is the value of "session".</td><td>Session UUID outputted to browser console.</td><td>As expected</td><td>Pass</td></tr><tr><td>2</td><td>Query SQLite database for username corresponding to session submitted in POST request.</td><td>When I am signed in, a brief message alongside my username is outputted to the browser console.</td><td>As expected</td><td>Pass</td></tr><tr><td>3</td><td>If no corresponding entry to the session submitted is found, send a 404 not found code instead.</td><td>When I am not signed in, a message telling me such is outputted to the browser console.</td><td>As expected</td><td>Pass</td></tr></tbody></table>

### Evidence

<figure><img src="../.gitbook/assets/image (36).png" alt=""><figcaption><p>Test 1: Session outputted to console obtained from browser cookie.</p></figcaption></figure>

<figure><img src="../.gitbook/assets/image (37).png" alt=""><figcaption><p>Test 2: When I'm signed in, my username is outputted to the browser console.</p></figcaption></figure>

<figure><img src="../.gitbook/assets/image (38).png" alt=""><figcaption><p>Test 3: When I'm signed out, a message saying "you are not signed in" is outputted to the browser console.</p></figcaption></figure>
