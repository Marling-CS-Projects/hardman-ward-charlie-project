# 2.2.2 Cycle 2: User account registration

## Design

In this cycle, I will write the code for the user account sign-up form. This will be where players provide their desired username and password to create their account. To ensure a basic level of account security, passwords must be a minimum of 8 characters. I will also make sure when registering that the username given is not taken by another user, and inform the user attempting to register that username if such.

### Objectives

* [x] Write HTML for an account registration form with username and password inputs.
* [x] Add CSS styling to make the form look more visually appealing.
* [x] Use body-parser middleware to allow Express.js to parse request bodies (this will be the information entered in the form).
* [x] Get username and password given by user.
* [x] Open database using openDatabase function written in [Cycle 1](2.2.1-cycle-1.md).
* [x] Check if desired username is already taken by another account. If it is, send back 409 (conflict) error with brief message explaining the problem and halt further execution.
* [x] Use Node implementation of bcrypt hashing algorithm to hash the password, which will make it unreadable by humans.
* [x] Write username and hashed password as new entry to users table of database. Send a message back to client saying registration was successful.

### Usability Features

### Key Variables

| Variable Name | Use                                                                                                                      |
| ------------- | ------------------------------------------------------------------------------------------------------------------------ |
| req.body      | Information submitted in the form, such as username and password.                                                        |
| res           | Send response to client.                                                                                                 |
| db            | Connection to SQLite database.                                                                                           |
| usernameTaken | Results of SQL query for entries in users table with the given username. If this is true, the username is already taken. |

### Pseudocode

{% code title="app.js" %}
```
import bcrypt
import body-parser

app.use(body-parser)

app.post_req('/sign-up', func async (req, res) {
    username = req.body.username
    password = req.body.password
    
    const db = await openDatabase()
    
    usernameTaken = await db.get("SELECT * FROM users WHERE username = ?", username)
    
    if usernameTaken {
        res.errorCode(409).message("Username already in use.")
        halt
    }
    
    hash = bcrypt.hash(password, salts = 10)
    
    await db.run("INSERT INTO users (username, password) VALUES (?, ?)", [username, hash]")
    await db.close()
    
    res.message("Account creation successful")
})
```
{% endcode %}

## Development

### Outcome



### Challenges



## Testing

Evidence for testing

### Tests

<table><thead><tr><th width="95">Test</th><th width="158">Instructions</th><th width="171">What I expect</th><th width="174">What actually happens</th><th>Pass/Fail</th></tr></thead><tbody><tr><td>1</td><td>Output to console on POST request to "/sign-up"</td><td>When I submit the form, a message will be outputted to my server console saying the POST request was received.</td><td>As expected</td><td>Pass</td></tr><tr><td>2</td><td>Output request body to server console.</td><td>When I submit the form, a JSON object containing the username and password I submitted will be outputted to the server console.</td><td>As expected</td><td>Pass</td></tr><tr><td>3</td><td>Hash submitted password using bcrypt implementation.</td><td>bcrypt-hashed password will be outputted to server console.</td><td>As expected</td><td>Pass</td></tr><tr><td>4</td><td>Write entry with username and hashed password to users table and display success message to client.</td><td>When I submit my information in the sign up form, I will be taken to a blank page page saying registration was successful. My username and hashed password will be in the users table of my database.</td><td>As expected</td><td>Pass</td></tr><tr><td>5</td><td>Display brief error message explaining the issue if the user attempts to register a username already in use by another user.</td><td>I will be taken to a blank page saying username is already in use if I try to register the same username as before.</td><td>As expected</td><td>Pass</td></tr></tbody></table>

### Evidence

<figure><img src="../.gitbook/assets/image (2) (1).png" alt=""><figcaption><p>Test 1: Message in server console after receiving POST request to sign up.</p></figcaption></figure>

<figure><img src="../.gitbook/assets/image (1) (1) (1) (1).png" alt=""><figcaption><p>Test 2: Request body containing details of form in server console after submission.</p></figcaption></figure>

<figure><img src="../.gitbook/assets/image (3) (1).png" alt=""><figcaption><p>Test 3: Hashed password outputted to server console.</p></figcaption></figure>

{% embed url="https://youtu.be/M5tEgmxAF-4" %}
Test 4: Registration successful message shown after submitting form.
{% endembed %}

<figure><img src="../.gitbook/assets/image (4) (1).png" alt=""><figcaption><p>Test 4: Entry with username and hashed password written to users table.</p></figcaption></figure>

{% embed url="https://youtu.be/hYx43Wm0PZY" %}
Test 5: Error message shown if I attempt to register an already-taken username.
{% endembed %}
