# 2.2.2 Cycle 2: User account registration

## Design

In this cycle, I will write the code for the user account sign-up form. This will be where players provide their desired username and password to create their account. To ensure a basic level of account security, passwords must be a minimum of 8 characters. I will also make sure when registering that the username given is not taken by another user, and inform the user attempting to register that username if such.

### Objectives

* [x] Design a page for the login and registration forms with HTML and CSS.
* [x] Use POST requests to send information in the form to the server.
* [x] If the given username is already taken by another account, display an error message.
* [x] Hash the password so it cannot be read.
* [x] Write an entry with the username and password to the users table.
* [x] Write HTML for an account registration form with username and password inputs.

### Usability Features

### Key Variables

| Variable Name | Use                                                                                                                      |
| ------------- | ------------------------------------------------------------------------------------------------------------------------ |
| req.body      | Information submitted in the form, such as username and password.                                                        |
| res           | Send response to client.                                                                                                 |
| db            | Connection to SQLite database.                                                                                           |
| usernameTaken | Results of SQL query for entries in users table with the given username. If this is true, the username is already taken. |

### Pseudocode

{% code title="app.js" %}
```
import bcrypt
import body-parser

app.use(body-parser)

app.post_req('/sign-up', func async (req, res) {
    username = req.body.username
    password = req.body.password
    
    const db = await openDatabase()
    
    usernameTaken = await db.get("SELECT * FROM users WHERE username = ?", username)
    
    if usernameTaken {
        res.errorCode(409).message("Username already in use.")
        halt
    }
    
    hash = bcrypt.hash(password, salts = 10)
    
    await db.run("INSERT INTO users (username, password) VALUES (?, ?)", [username, hash]")
    await db.close()
    
    res.message("Account creation successful")
})
```
{% endcode %}

## Development

### Outcome



### Challenges



## Testing

Evidence for testing

### Tests

<table><thead><tr><th width="95">Test</th><th width="158">Instructions</th><th width="171">What I expect</th><th width="174">What actually happens</th><th>Pass/Fail</th></tr></thead><tbody><tr><td>1</td><td>Print to server console on POST request.</td><td>Message printed to server console after submitting form.</td><td>As expected</td><td>Pass</td></tr><tr><td>2</td><td>Print request body to server console.</td><td>Username and password submitted in form printed to server console.</td><td>As expected</td><td>Pass</td></tr><tr><td>3</td><td>Print bcrypt hashed password to server console.</td><td>Hashed password printed to server console.</td><td>As expected</td><td>Pass</td></tr><tr><td>4</td><td>Write entry to users table and display success message in browser.</td><td>Browser displays message saying registration was successful after submitting form.</td><td>As expected</td><td>Pass</td></tr><tr><td>5</td><td>If the user attempts to register a taken username, display an error message in the browser.</td><td>Browser displays error message saying username already taken if the username is taken by another account.</td><td>As expected</td><td>Pass</td></tr></tbody></table>

### Evidence

<figure><img src="../.gitbook/assets/image (2) (1).png" alt=""><figcaption><p>Test 1: Message in server console after receiving POST request to sign up.</p></figcaption></figure>

<figure><img src="../.gitbook/assets/image (1) (1) (1) (1) (1) (1).png" alt=""><figcaption><p>Test 2: Request body containing details of form in server console after submission.</p></figcaption></figure>

<figure><img src="../.gitbook/assets/image (3) (1).png" alt=""><figcaption><p>Test 3: Hashed password outputted to server console.</p></figcaption></figure>

{% embed url="https://youtu.be/M5tEgmxAF-4" %}
Test 4: Registration successful message shown after submitting form.
{% endembed %}

<figure><img src="../.gitbook/assets/image (4) (1).png" alt=""><figcaption><p>Test 4: Entry with username and hashed password written to users table.</p></figcaption></figure>

{% embed url="https://youtu.be/hYx43Wm0PZY" %}
Test 5: Error message shown if I attempt to register an already-taken username.
{% endembed %}
