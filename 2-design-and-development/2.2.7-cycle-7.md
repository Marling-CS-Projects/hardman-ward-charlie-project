# 2.2.7 Cycle 7: Waiting for players screen

## Design

In this cycle, I will be adding another scene to my game. This scene will display the room name and a continually updated list of players connected. It will have a start button which any player in the room can click to start the game. Because I haven't got to developing the gameplay itself yet, for now when a player clicks the button a message will just be outputted in the browser console of every player in the same room.

### Objectives

* [x] Create a new scene called "wait"
* [x] When the client receives an event telling them they've joined a room, go to the waiting scene.
* [x] Display the room code at the top.
* [x] Continually send an event to the server asking for a list of usernames of members of the room.
* [x] Show all the names in the centre of the screen.
* [x] Add a button below the usernames to start the game.
* [x] When any client clicks the start button, emit an event to all clients in the same room telling them to start game. On receiving this event, clients change to scene "lvl1", which is empty for now.

### Usability Features

### Key Variables

| Variable Name | Use                                             |
| ------------- | ----------------------------------------------- |
| room          | Code of room the player has joined.             |
| usernames     | List of usernames of all clients in room.       |
| usernamesList | Text in waiting scene to display each username. |

### Pseudocode

{% code title="scenes/wait.js" %}
```
func waitScene(room):
    add_text("Your room code is " + room, 
        size: 25, 
        color: grey,
        pos: centerX, centerY - 200
    )
    
    usernamesList = add_text("",
        size: 20,
        color: grey,
        pos: center
    )
    
    update:
        socket.emit('update usernames')
        
    socket.on('update usernames', usernames => {
        usernamesList = ""
        
        for u in usernames:
            usernamesList.addLine(u)    
    })
    
    startButton = Button(centerX, centerY + 120, "Start")
    
    startButton.click:
        socket.emit('start game')
        
    socket.on('start game', () => {
        go("lvl1")
    })
```
{% endcode %}

{% code title="scenes/multiplayer.js" %}
```
func multiplayerScene:
    socket.on('join room', room => {
        go("wait", room)
    })
```
{% endcode %}

{% code title="server.js" %}
```
socket.on('update usernames', () => {
    usernames = []
    
    for id in toKeys(rooms[room].members) {
        usernames.addItem(rooms[room].members[id].username)
    }
    
    socket.emit('update usernames', usernames)
})

socket.on('start game', () => {
    io.to(room).emit('start game')
})
```
{% endcode %}

## Development

### Outcome



### Challenges



## Testing

Evidence for testing

### Tests

<table><thead><tr><th width="95">Test</th><th width="158">Instructions</th><th width="171">What I expect</th><th width="174">What actually happens</th><th>Pass/Fail</th></tr></thead><tbody><tr><td>1</td><td>Go to wait scene after joining room.</td><td>Empty blue screen after I create or join a room.</td><td>As expected</td><td>Pass</td></tr><tr><td>2</td><td>Show room code 200px above centre of screen.</td><td>Message with room code shown above centre of screen.</td><td>As expected</td><td>Pass</td></tr><tr><td>3</td><td>Continually get list of usernames in room and display it on waiting screen.</td><td>List of usernames on screen continually refreshes. I will create a room on one account and join from another, both usernames should instantly appear in each window.</td><td>As expected</td><td>Pass</td></tr><tr><td>4</td><td>Add start button 120px below centre of screen.</td><td>Start button appears below list of usernames.</td><td>As expected</td><td>Pass</td></tr><tr><td>5</td><td>On clicking start button, go to lvl1 scene.</td><td>I will again create a room and join from a different account. When I click start, both windows should go to a blank blue screen.</td><td>As expected</td><td>Pass</td></tr></tbody></table>

### Evidence

<figure><img src="../.gitbook/assets/image.png" alt=""><figcaption><p>Test 1: Empty blue screen after creating/joining a room.</p></figcaption></figure>

<figure><img src="../.gitbook/assets/image (1).png" alt=""><figcaption><p>Test 2: Room code displayed after joining/creating a room</p></figcaption></figure>

{% embed url="https://www.youtube.com/watch?v=28NBOBfS4HI" %}
Test 3: Username list continually refreshes to show new usernames
{% endembed %}

<figure><img src="../.gitbook/assets/image (52).png" alt=""><figcaption><p>Test 4: Start button shows below list of usernames</p></figcaption></figure>

{% embed url="https://youtu.be/Fwf7LzcgoLM" %}
Test 5: Clicking start emits to all clients to go to level 1 scene (currently empty)
{% endembed %}
