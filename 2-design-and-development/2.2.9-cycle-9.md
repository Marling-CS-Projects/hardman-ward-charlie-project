# 2.2.9 Cycle 9: Car movement and scrolling

## Design

In this cycle I will be adding car sprites for each player in the room. I have made five different car sprites of different colours: red, green, blue, yellow, and purple. Cars will be assigned in order of who joined first, for example the player who created the room will get the red car. The player can control their own car using WSAD and all updates in co-ordinates and rotation will be broadcast to all other players in the room.

### Objectives

* [ ] Render a car for each player that is in the room
* [ ] Store the player's car in a separate variable and add acceleration, speed, friction, and maximum speed properties.
* [ ] Continually check for WSAD keys to be pressed.
* [ ] When W or S is pressed, add or subtract the player's car acceleration from its speed.
* [ ] When A or D is pressed, turn the player's car left or right.
* [ ] Continually use the sin and cos functions with the player speed and angle to calculate the change in X and Y for the player.
* [ ] Continually reduce the speed by the friction. If the speed is less than the friction, set the speed to 0 to prevent the car moving slowly indefinitely when it should be still.
* [ ] Continually check if the speed exceeds the maximum speed and set it back if it does.
* [ ] Broadcast to all other players in the room the new co-ordinates and angle of the car.
* [ ] When another player's car is moved, their car's position is set to the new co-ordinates and the angle to the new angle.

### Usability Features

### Key Variables

| Variable Name | Use                                     |
| ------------- | --------------------------------------- |
| myCar         | The player's own car that they control. |

### Pseudocode

{% code title="sprites/car.js" %}
```
func Car(x, y, colour):
    return add([
        sprite("car_" + colour),
        area(),
        body(),
        anchor("center"),
        pos(x, y),
        z(2),
        "car"
    ])
    
func Mechanics(car, index):
    car.controls = {
        forward: false,
        reverse: false,
        left: false,
        right: false
    }
    
    car.speed = 0
    car.maxSpeed = 10
    car.acceleration = 0.2
    car.friction = 0.05
    
    update:
        if car.controls.forward:
            car.speed += car.acceleration
        
        if car.controls.reverse:
            car.speed -= car.acceleration
            
        if car.controls.left:
            car.angle--
            
        if car.controls.right:
            car.angle++
        
        if car.speed > car.maxSpeed:
            car.speed = car.maxSpeed
            
        if car.speed < -car.maxSpeed / 2:
            car.speed = -car.maxSpeed / 2
            
        if car.speed > 0:
            car.speed -= car.friction
            
        if car.speed < 0:
            car.speed += car.friction
            
        if modulusOf(car.speed) < car.friction:
            car.speed = 0
            
        car.pos.x += sin(car.angle) * car.speed
        car.pos.y += cos(car.angle) * car.speed
        
        socket.emit('update car', {
            position: car.pos,
            angle: car.angle,
            index: index
        })
        
        controlDefinitions = {
            "w": "forward",
            "s": "reverse",
            "a": "left",
            "d": "right"
        }
        
        keyDown(k => {
            if keys(controlDefinitions).includes(k):
                control = controlDefinitions[k]
                car.controls[control] = true
        })
        
        keyReleased(k => {
            if keys(controlDefinitions).includes(k):
                control = controlDefinitions[k]
                car.controls[control] = false
        })
```
{% endcode %}

{% code title="scenes/level.js" %}
```
```
{% endcode %}

## Development

### Outcome



### Challenges



## Testing

Evidence for testing

### Tests

<table><thead><tr><th width="95">Test</th><th width="158">Instructions</th><th width="171">What I expect</th><th width="174">What actually happens</th><th>Pass/Fail</th></tr></thead><tbody><tr><td>1</td><td>Run initial code</td><td></td><td></td><td></td></tr></tbody></table>

### Evidence

