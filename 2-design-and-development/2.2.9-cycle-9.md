# 2.2.9 Cycle 9: Car movement and scrolling

## Design

In this cycle I will be adding car sprites for each player in the room. I have made five different car sprites of different colours: red, green, blue, yellow, and purple. Cars will be assigned in order of who joined first, for example the player who created the room will get the red car. The player can control their own car using WSAD and all changes in co-ordinates and rotation will be broadcast to all other players in the room so that they can update the position and angle of the corresponding car sprite.

### Objectives

* [x] Render a car for each room member.
* [x] Add acceleration, speed, maximum speed, and friction properties to the player's car.
* [x] Keys W and S move forward and reverse the car.
* [x] Keys A and D turn left and right the car.
* [x] Continually move the car forward using cos and sin functions to calculate the change in X and Y according to angle and speed.
* [x] Update the car's position and angle for all other players.
* [x] Render a car for each player that is in the room

### Usability Features

### Key Variables

| Variable Name | Use                                     |
| ------------- | --------------------------------------- |
| myCar         | The player's own car that they control. |

### Pseudocode

{% code title="sprites/car.js" %}
```
func Car(x, y, colour):
    return add([
        sprite("car_" + colour),
        area(),
        body(),
        anchor("center"),
        pos(x, y),
        z(2),
        "car"
    ])
    
func Mechanics(car, index):
    car.controls = {
        forward: false,
        reverse: false,
        left: false,
        right: false
    }
    
    car.speed = 0
    car.maxSpeed = 10
    car.acceleration = 0.2
    car.friction = 0.05
    
    update:
        if car.controls.forward:
            car.speed += car.acceleration
        
        if car.controls.reverse:
            car.speed -= car.acceleration
            
        if car.controls.left:
            car.angle--
            
        if car.controls.right:
            car.angle++
        
        if car.speed > car.maxSpeed:
            car.speed = car.maxSpeed
            
        if car.speed < -car.maxSpeed / 2:
            car.speed = -car.maxSpeed / 2
            
        if car.speed > 0:
            car.speed -= car.friction
            
        if car.speed < 0:
            car.speed += car.friction
            
        if modulus(car.speed) < car.friction:
            car.speed = 0
            
        car.pos.x += sin(car.angle) * car.speed
        car.pos.y += cos(car.angle) * car.speed
        
        socket.emit('update car', {
            position: car.pos,
            angle: car.angle,
            index: index
        })
        
        controlDefinitions = {
            "w": "forward",
            "s": "reverse",
            "a": "left",
            "d": "right"
        }
        
        keyDown(k => {
            if keys(controlDefinitions).includes(k):
                control = controlDefinitions[k]
                car.controls[control] = true
        })
        
        keyReleased(k => {
            if keys(controlDefinitions).includes(k):
                control = controlDefinitions[k]
                car.controls[control] = false
        })
```
{% endcode %}

{% code title="scenes/level.js" %}
```
```
{% endcode %}

## Development

### Outcome



### Challenges



## Testing

Evidence for testing

### Tests

<table><thead><tr><th width="95">Test</th><th width="158">Instructions</th><th width="171">What I expect</th><th width="174">What actually happens</th><th>Pass/Fail</th></tr></thead><tbody><tr><td>1</td><td>Draw a car for each player of the room.</td><td>On starting the game, a different colour car is rendered for the number of players in the room.</td><td>As expected</td><td>Pass</td></tr><tr><td>2</td><td>If W is pressed, accelerate the car.</td><td>Car moves forward on pressing W.</td><td>Car reverses.</td><td>Fail</td></tr><tr><td>3</td><td>Subtract the speed from Y instead of adding.</td><td>Car moves forward on pressing W.</td><td>As expected</td><td>Pass</td></tr><tr><td>4</td><td>If A/D are pressed, move the car left/right.</td><td>Car turns left on pressing A and right on pressing D.</td><td>As expected</td><td>Pass</td></tr><tr><td>5</td><td>If S is pressed, decelerate the car.</td><td>Car reverses on pressing S.</td><td>As expected</td><td>Pass</td></tr><tr><td>6</td><td>Calculate change in X and Y using sin and cos functions with the angle.</td><td>Car moves diagonally if turned.</td><td>Car moves in unexpected ways and directions inconsistent with its angle.</td><td>Fail</td></tr><tr><td>7</td><td>Convert angle in degrees to radians when using sin and cos.</td><td>Car moves diagonally if turned.</td><td>As expected</td><td>Pass</td></tr><tr><td>8</td><td>Continually set the camera position.</td><td>The car is always at the bottom of the screen and the road is in the middle.</td><td>As expected</td><td>Pass</td></tr><tr><td>9</td><td>Broadcast updates in car position and angle to other players.</td><td>When one player moves or turns their car, changes are shown to all players.</td><td>As expected</td><td>Pass</td></tr></tbody></table>

### Evidence

<figure><img src="../.gitbook/assets/image (1).png" alt=""><figcaption><p>Test 1: Car rendered for each of three players connected to the room</p></figcaption></figure>

{% embed url="https://youtu.be/qa4WgswJ77U" %}
Test 2: Car moves in reverse when it's supposed to go forward
{% endembed %}

{% embed url="https://youtu.be/tu0CJ8UEaTo" %}
Test 3: Car moves forward when I press W
{% endembed %}

{% embed url="https://youtu.be/r_7G3HbIox0" %}
Test 4: Car rotates when I press A and D
{% endembed %}

{% embed url="https://youtu.be/2qlGUHqqEfs" %}
Test 5: Car reverses when I press S
{% endembed %}

{% embed url="https://youtu.be/VNWMjThE2gI" %}
Test 6: Rotated car moves in inconsistent and unexpected ways&#x20;
{% endembed %}

{% embed url="https://youtu.be/JFFEBn6oefM" %}
Test 7: Car moves according to its angle
{% endembed %}

{% embed url="https://youtu.be/EGs7Lyyj0L0" %}
Test 8: Camera moves along with car so car is near the bottom of the screen
{% endembed %}

{% embed url="https://youtu.be/jutYe_0Zrgw" %}
Test 9: Updates in car movement shown to all clients in the room
{% endembed %}
