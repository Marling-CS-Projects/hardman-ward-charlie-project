# 2.2.9 Cycle 9: Car movement and scrolling

## Design

In this cycle I will be adding car sprites for each player in the room. I have made five different car sprites of different colours: red, green, blue, yellow, and purple. Cars will be assigned in order of who joined first, for example the player who created the room will get the red car. The player can control their own car using WSAD and all changes in co-ordinates and rotation will be broadcast to all other players in the room so that they can update the position and angle of the corresponding car sprite.

### Objectives

* [x] Render a car for each player that is in the room
* [x] Add acceleration, speed, max speed, and friction properties to the player's own car.
* [x] Continually check for WSAD keys to be pressed.
* [x] When W or S is pressed, add or subtract the player's car acceleration from its speed.
* [x] When A or D is pressed, turn the player's car left or right.
* [x] Continually use the sin and cos functions with the player speed and angle to calculate the change in X and Y for the player.
* [x] Continually reduce the speed by the friction. If the speed is less than the friction, set the speed to 0 to prevent the car moving slowly indefinitely when it should be still.
* [x] Continually check if the speed exceeds the maximum speed and set it back if it does.
* [x] Broadcast to all other players in the room the new co-ordinates and angle of the car.
* [x] When another player's car is moved, their car's position is set to the new co-ordinates and the angle to the new angle.

### Usability Features

### Key Variables

| Variable Name | Use                                     |
| ------------- | --------------------------------------- |
| myCar         | The player's own car that they control. |

### Pseudocode

{% code title="sprites/car.js" %}
```
func Car(x, y, colour):
    return add([
        sprite("car_" + colour),
        area(),
        body(),
        anchor("center"),
        pos(x, y),
        z(2),
        "car"
    ])
    
func Mechanics(car, index):
    car.controls = {
        forward: false,
        reverse: false,
        left: false,
        right: false
    }
    
    car.speed = 0
    car.maxSpeed = 10
    car.acceleration = 0.2
    car.friction = 0.05
    
    update:
        if car.controls.forward:
            car.speed += car.acceleration
        
        if car.controls.reverse:
            car.speed -= car.acceleration
            
        if car.controls.left:
            car.angle--
            
        if car.controls.right:
            car.angle++
        
        if car.speed > car.maxSpeed:
            car.speed = car.maxSpeed
            
        if car.speed < -car.maxSpeed / 2:
            car.speed = -car.maxSpeed / 2
            
        if car.speed > 0:
            car.speed -= car.friction
            
        if car.speed < 0:
            car.speed += car.friction
            
        if modulus(car.speed) < car.friction:
            car.speed = 0
            
        car.pos.x += sin(car.angle) * car.speed
        car.pos.y += cos(car.angle) * car.speed
        
        socket.emit('update car', {
            position: car.pos,
            angle: car.angle,
            index: index
        })
        
        controlDefinitions = {
            "w": "forward",
            "s": "reverse",
            "a": "left",
            "d": "right"
        }
        
        keyDown(k => {
            if keys(controlDefinitions).includes(k):
                control = controlDefinitions[k]
                car.controls[control] = true
        })
        
        keyReleased(k => {
            if keys(controlDefinitions).includes(k):
                control = controlDefinitions[k]
                car.controls[control] = false
        })
```
{% endcode %}

{% code title="scenes/level.js" %}
```
```
{% endcode %}

## Development

### Outcome



### Challenges



## Testing

Evidence for testing

### Tests

<table><thead><tr><th width="95">Test</th><th width="158">Instructions</th><th width="171">What I expect</th><th width="174">What actually happens</th><th>Pass/Fail</th></tr></thead><tbody><tr><td>1</td><td>Render up to five cars for each player in the room.</td><td>I will join a room from multiple browser windows. When I click start, a different colour car should be rendered for each player.</td><td>As expected</td><td>Pass</td></tr><tr><td>2</td><td>When the player presses W, accelerate the car.</td><td>When I press W, my car moves forward.</td><td>Car actually moves in reverse.</td><td>Fail</td></tr><tr><td>3</td><td>Subtract from Y position instead of adding when the player is moving forward.</td><td>When I press W, my car moves forward.</td><td>As expected</td><td>Pass</td></tr><tr><td>4</td><td>When the player presses A and D, the car turns left and right respectively.</td><td>When I press A, my car turns left. When I press D, it turns right. </td><td>As expected</td><td>Pass</td></tr><tr><td>5</td><td>When the player presses S, decelerate the car.</td><td>When I press S, my car reverses.</td><td>As expected</td><td>Pass</td></tr><tr><td>6</td><td>Use sin and cos functions to move according to angle.</td><td>When my car moves forward or in reverse, it also moves left and right depending on how it is turned.</td><td>Car moves in unexpected ways and directions inconsistent with its angle.</td><td>Fail</td></tr><tr><td>7</td><td>Convert angle to radians when calculating speed to move at.</td><td>When my car moves forward or in reverse, it also moves left and right depending on how it is turned.</td><td>As expected</td><td>Pass</td></tr><tr><td>8</td><td>Continually update the camera position so the road is always in the centre of the screen and the player's own car is at the bottom.</td><td>When I move my car, the camera follows so my car is at the bottom of the screen.</td><td>As expected</td><td>Pass</td></tr><tr><td>9</td><td>Broadcast updates in car position and angle to other clients in the room.</td><td>When I move/rotate my car in one window it shows in all windows.</td><td>As expected</td><td>Pass</td></tr></tbody></table>

### Evidence

<figure><img src="../.gitbook/assets/image (1).png" alt=""><figcaption><p>Test 1: Car rendered for each of three players connected to the room</p></figcaption></figure>

{% embed url="https://youtu.be/qa4WgswJ77U" %}
Test 2: Car moves in reverse when it's supposed to go forward
{% endembed %}

{% embed url="https://youtu.be/tu0CJ8UEaTo" %}
Test 3: Car moves forward when I press W
{% endembed %}

{% embed url="https://youtu.be/r_7G3HbIox0" %}
Test 4: Car rotates when I press A and D
{% endembed %}

{% embed url="https://youtu.be/2qlGUHqqEfs" %}
Test 5: Car reverses when I press S
{% endembed %}

{% embed url="https://youtu.be/VNWMjThE2gI" %}
Test 6: Rotated car moves in inconsistent and unexpected ways&#x20;
{% endembed %}

{% embed url="https://youtu.be/JFFEBn6oefM" %}
Test 7: Car moves according to its angle
{% endembed %}

{% embed url="https://youtu.be/EGs7Lyyj0L0" %}
Test 8: Camera moves along with car so car is near the bottom of the screen
{% endembed %}

{% embed url="https://youtu.be/jutYe_0Zrgw" %}
Test 9: Updates in car movement shown to all clients in the room
{% endembed %}
